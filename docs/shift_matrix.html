---
layout: sub
title: Shift Matrix
---
<h3>Shift Matrix</h3>
<table id="shift-matrix"></table>

<p>To request to be scheduled for a certain day, send mail to staff@.</p>

<h3>Terms Matrix</h3>
<table id="terms-matrix">
<tr>
<th>name</th>
<th>current term</th>
<th>next term</th>
</tr>
</table>

<script src="/jquery.min.js"></script>
<script>
  function gen_row(row) {
    var jsrow = $('<tr></tr>');
    jsrow.append('<th class="date">' + row['date'] + ' ' + row['dow'] + '</th>');
    var row_class = 'unscheduled';
    for (scheduled in row['shifts']) {
      cell_class = 'unscheduled';
      cell_content = '';
      if (row['shifts'][scheduled] == '1') {
        row_class = 'scheduled';
        cell_class = 'scheduled';
        cell_content = 'X';
      }
      var cell = $('<td></td>').addClass(cell_class).text(cell_content);
      jsrow.append(cell);
    }
    jsrow.addClass(row_class);
    return jsrow;
  }
  function date_is_scheduled(row) {
    for (scheduled in row['shifts']) {
      if (row['shifts'][scheduled] == '1') {
        return true;
      }
    }
    return false;
  }
  function strip_unscheduled_dates(data) {
    var latest_scheduled_index = 0;
    for (var row = 0; row < data.length; row++) {
      if (date_is_scheduled(data[row])) {
        latest_scheduled_index = row;
      }
    }
    var latest_visible_index = latest_scheduled_index + 4;
    return data.slice(0, latest_visible_index);
  }
  function full_table(data) {
    var table = $("table#shift-matrix");
    var header = $('<tr></tr>');
    header.append('<th></th>');
    for (i in data['all_staff']) {
      header.append('<th>' + data['all_staff'][i] + '</th>');
    }
    table.append(header);
    stripped_data = strip_unscheduled_dates(data['data']);
    for (row in stripped_data) {
      table.append(gen_row(data['data'][row]));
    }
  }

  /* Dues Collector View (terms matrix) */
  function terms_data(data) {
    var table = $("table#terms-matrix");
    for (member in data) {
      current_term_range = data[member]['current_term'] + ' — ' + data[member]['next_term'];
      next_term_range = data[member]['next_term'] + ' — ' + data[member]['next_next_term'];
      var row = $('<tr></tr>');
      row.append($('<td></td>').text(member))
      row.append($('<td></td>').text(current_term_range))
      row.append($('<td></td>').text(next_term_range))
      table.append(row);
    }
  }
</script>
<script type="application/javascript" src="http://sbk.sankey.info/hacks/full_table.cgi?callback=full_table"></script>
<script type="application/javascript" src="http://sbk.sankey.info/hacks/terms_data.cgi?callback=terms_data"></script>
<style>
#shift-matrix tr.scheduled {
  background-color:#afa;
  text-align:center;
}
#shift-matrix tr.unscheduled {
  background-color:#faa;
}
</style>
